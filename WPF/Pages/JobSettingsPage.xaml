<Page x:Class="WPF.Pages.JobSettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:viewModel="clr-namespace:Core.ViewModel;assembly=Core"
      xmlns:conv="clr-namespace:WPF.Converter"
      Title="JobPage"
      Background="#1E1E2E"
      DataContext="{x:Static viewModel:ViewModelLocator.JobViewModel}">
    
    <Page.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>

        <Style TargetType="TextBox" x:Key="PlaceholderStyle">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <TextBox x:Name="tb"
                                     Background="Transparent"
                                     Text="{TemplateBinding Text}"
                                     Foreground="{TemplateBinding Foreground}"
                                     BorderThickness="0"/>
                            <TextBlock Text="Enter encryption key..."
                                       Foreground="#6C7086"
                                       Margin="5,0,0,0"
                                       IsHitTestVisible="False"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding Text, ElementName=tb, Converter={StaticResource BoolToVisibility}}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#313244" Padding="20" CornerRadius="10">
            <TextBox Text="{Binding CurrentJob.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                     FontSize="28" Foreground="#CDD6F4" Background="Transparent" 
                     BorderThickness="0" HorizontalAlignment="Center"/>
        </Border>

        <!-- Body -->
        <StackPanel Grid.Row="1" Margin="0,20" HorizontalAlignment="Center" VerticalAlignment="Top">
            <Button Content="Define source path" Click="OnSetSourcePathClick" Width="250" Height="45" Background="#89B4FA" Foreground="Black" Margin="0,5"/>
            <Button Content="Define target path" Click="OnSetTargetPathClick" Width="250" Height="45" Background="#89B4FA" Foreground="Black" Margin="0,5"/>
            <ComboBox Width="250" Height="36"
                      ItemsSource="{Binding Source={StaticResource BackupTypeEnum}}"
                      SelectedItem="{Binding CurrentJob.Type, Mode=TwoWay}"
                      Background="#313244"
                      Foreground="#CDD6F4"
                      BorderBrush="#A6ADC8"
                      FontSize="16"
                      Margin="0,5"/>


            <!-- Encryption UI -->
            <TextBox x:Name="KeyInput"
                     Width="250" Height="30"
                     Background="#313244"
                     Foreground="#CDD6F4"
                     BorderBrush="#A6ADC8"
                     FontSize="16"
                     Style="{StaticResource PlaceholderStyle}" />
            <Button Content="Encrypt / Decrypt" Click="OnToggleEncryptionClick" Width="250" Height="45" Background="#F9E2AF" Foreground="Black" Margin="0,5"/>

            <!-- Commands -->
            <Button Content="Run" Command="{Binding RunBackupCommand}" IsEnabled="{Binding CurrentJob.IsReady}" Width="250" Height="45" Background="#A6E3A1" Foreground="Black" Margin="0,5"/>
            <Button Content="Delete" Click="OnDeleteJobClick" Width="250" Height="45" Background="#F38BA8" Foreground="Black" Margin="0,5"/>
            <Button Content="Reset" Command="{Binding ResetJobCommand}" Width="250" Height="45" Background="#89DCEB" Foreground="Black" Margin="0,5"/>
        </StackPanel>
    </Grid>
</Page>
