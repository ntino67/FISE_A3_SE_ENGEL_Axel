<Page x:Class="WPF.Pages.AppSettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Paramètres"
      Background="#1e1e2e">

    <Grid Margin="30,20,30,20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tête de la page -->
        <TextBlock Grid.Row="0" 
                   Text="{DynamicResource TextGeneralsettings}"
                   FontSize="32" 
                   FontWeight="Bold" 
                   Margin="0,0,0,30"
                   Foreground="#cdd6f4"/>

        <!-- Contenu principal avec ScrollViewer pour s'adapter à de futures sections -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Section de sélection de langue -->
                <Border Background="#232336" 
         CornerRadius="12"
         Padding="20" 
         Margin="0,0,0,20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Titre de la section -->
                        <TextBlock Grid.Row="0"
                    Text="Langue de l'application"
                    FontSize="22" 
                    FontWeight="SemiBold" 
                    Margin="0,0,0,10"
                    Foreground="#cdd6f4"/>

                        <!-- Description de la section -->
                        <TextBlock Grid.Row="1" 
                    Text="Choisissez la langue de l'interface utilisateur."
                    TextWrapping="Wrap"
                    Margin="0,0,0,15"
                    Foreground="#a6adc8"/>

                        <!-- Sélection de langue -->
                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                        Text="Langue :"
                        FontSize="16"
                        VerticalAlignment="Center"
                        Margin="0,0,15,0"
                        Foreground="#cdd6f4"/>

                            <ComboBox x:Name="LanguageSelector"
                       SelectedValue="{Binding SelectedLanguage, Mode=TwoWay}"
                       SelectedValuePath="Content"
                       Grid.Column="1"
                       Height="40"
                       MaxWidth="300"
                       HorizontalAlignment="Left"
                       Background="#313244"
                       Foreground="#cdd6f4"
                       BorderThickness="0"
                       Padding="15,0"
                       FontSize="16"
                       VerticalContentAlignment="Center"
                                      SelectionChanged="LanguageSelector_SelectionChanged">
                                <ComboBox.Resources>
                                    <SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}" Color="#313244"/>
                                    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#74c7ec"/>
                                </ComboBox.Resources>
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding}" Foreground="#cdd6f4"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                                <ComboBoxItem Content="Français"/>
                                <ComboBoxItem Content="English"/>
                            </ComboBox>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Section applications bloquantes -->
                <Border Background="#232336" 
                        CornerRadius="12"
                        Padding="20" 
                        Margin="0,0,0,20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Titre de la section -->
                        <TextBlock Grid.Row="0"
                                   Text="Applications bloquantes"
                                   FontSize="22" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,10"
                                   Foreground="#cdd6f4"/>

                        <!-- Description de la section -->
                        <TextBlock Grid.Row="1" 
                                   Text="Définissez les applications qui bloqueront les tâches de sauvegarde lorsqu'elles sont en cours d'exécution. Dans le cas de tâches séquentielles, le logiciel terminera la tâche en cours et s'arrêtera avant de démarrer la suivante."
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,15"
                                   Foreground="#a6adc8"/>

                        <!-- Zone d'ajout d'application -->
                        <Grid Grid.Row="2" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Champ texte -->
                            <TextBox x:Name="BlockingAppTextBox"
                                     Grid.Column="0"
                                     Height="40"
                                     Margin="0,0,10,0"
                                     Background="#313244"
                                     Foreground="#cdd6f4"
                                     BorderThickness="0"
                                     Padding="15,0"
                                     FontSize="16"
                                     VerticalContentAlignment="Center"
                                     BorderBrush="#74c7ec"/>

                            <!-- Bouton ajouter -->
                            <Button x:Name="AddBlockingAppButton"
                                    Grid.Column="1"
                                    Content="Ajouter"
                                    Height="40"
                                    Width="100"
                                    Margin="0,0,10,0"
                                    Background="#74c7ec"
                                    Foreground="#232336"
                                    FontWeight="Bold"
                                    BorderThickness="0"
                                    Click="AddBlockingAppButton_Click"/>

                            <!-- Bouton détecter -->
                            <Button x:Name="DetectRunningAppButton"
                                    Grid.Column="2"
                                    Content="Détecter"
                                    Height="40"
                                    Width="100"
                                    Background="Transparent"
                                    Foreground="#74c7ec"
                                    FontWeight="Bold"
                                    BorderThickness="1"
                                    BorderBrush="#74c7ec"
                                    Click="DetectRunningAppButton_Click"/>
                        </Grid>

                        <!-- Liste des applications bloquantes -->
                        <Border Grid.Row="3"
                                Background="#313244" 
                                CornerRadius="8"
                                Margin="0,5,0,0">
                            <ListView x:Name="BlockingAppsListBox"
                                      ItemsSource="{Binding BlockingApplications}"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      Foreground="#cdd6f4"
                                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                                      MaxHeight="300"
                                      MinHeight="150">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Height="40" Margin="5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                <!-- Icône application -->
                                                <Viewbox Width="18" Height="18" Margin="0,0,10,0">
                                                    <Canvas Width="24" Height="24">
                                                        <Path Fill="#74c7ec" Data="M21 2H3C1.9 2 1 2.9 1 4V20C1 21.1 1.9 22 3 22H21C22.1 22 23 21.1 23 20V4C23 2.9 22.1 2 21 2M21 7H3V4H21V7Z"/>
                                                    </Canvas>
                                                </Viewbox>
                                                <!-- Nom de l'application -->
                                                <TextBlock Text="{Binding}" 
                                                           FontSize="16" 
                                                           VerticalAlignment="Center" 
                                                           Foreground="#cdd6f4"/>
                                            </StackPanel>

                                            <!-- Bouton supprimer -->
                                            <Button Grid.Column="1" 
                                                    Width="30" 
                                                    Height="30"
                                                    Margin="10,0,0,0"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    ToolTip="Supprimer"
                                                    Tag="{Binding}"
                                                    Click="RemoveBlockingAppButton_Click">
                                                <Viewbox Width="16" Height="16">
                                                    <Canvas Width="24" Height="24">
                                                        <Path Fill="#f38ba8" Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                                                    </Canvas>
                                                </Viewbox>
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>

                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Padding" Value="10,5"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#45475a"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListView.ItemContainerStyle>
                            </ListView>
                        </Border>
                    </Grid>
                </Border>

                <!-- Espace réservé pour les futures sections -->
                <Border Background="#232336" 
                        CornerRadius="12"
                        Padding="20" 
                        Margin="0,0,0,20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="Paramètres additionnels"
                                   FontSize="22" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,10"
                                   Foreground="#cdd6f4"/>

                        <TextBlock Grid.Row="1" 
                                   Text="Cette section est réservée pour de futures options."
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"
                                   Foreground="#a6adc8"/>
                    </Grid>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Boutons d'action -->
        <Grid Grid.Row="2" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Indicateur d'état -->
            <TextBlock Grid.Column="0" 
                       x:Name="StatusMessage"
                       Foreground="#a6e3a1" 
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"
                       Visibility="Collapsed"/>

            <!-- Boutons -->
            <StackPanel Grid.Column="2" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right">
                <Button x:Name="SaveSettingsButton"
                        Content="Enregistrer"
                        Height="40"
                        Width="150"
                        Margin="0,0,15,0"
                        Background="#74c7ec"
                        Foreground="#232336"
                        FontWeight="Bold"
                        BorderThickness="0"
                        FontSize="16"
                        Click="SaveSettingsButton_Click"/>

                <Button x:Name="CancelButton"
                        Content="Annuler"
                        Height="40"
                        Width="120"
                        Background="Transparent"
                        Foreground="#74c7ec"
                        FontWeight="Bold"
                        BorderThickness="1"
                        BorderBrush="#74c7ec"
                        FontSize="16"
                        Click="CancelButton_Click"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
